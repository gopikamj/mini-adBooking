{"ast":null,"code":"var _jsxFileName = \"D:\\\\gopika\\\\backup_08_02_2025\\\\online-newspaper-ad-booking\\\\frontend\\\\src\\\\pages\\\\layouts\\\\DeccanChroniclesBooking.js\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect, useContext } from \"react\";\nimport { useLocation, useNavigate } from \"react-router-dom\";\nimport { AuthContext } from \"../../context/AuthContext\";\nimport \"../../styles/DeccanChroniclesBooking.css\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst DeccanChroniclesBooking = () => {\n  _s();\n  const {\n    user\n  } = useContext(AuthContext);\n  const location = useLocation();\n  const navigate = useNavigate();\n  const {\n    price: basePrice,\n    newspaperId = 1,\n    spaceId,\n    newspaperName\n  } = location.state || {};\n\n  // Form states\n  const [adTitle, setAdTitle] = useState(\"\");\n  const [adContent, setAdContent] = useState(\"\");\n  const [category, setCategory] = useState(\"Jobs\");\n  const [duration, setDuration] = useState(1);\n  const [totalPrice, setTotalPrice] = useState(basePrice || 0);\n  const [loading, setLoading] = useState(false);\n\n  // Calculate price dynamically\n  useEffect(() => {\n    const calculatedPrice = (basePrice + adContent.length * 0.5) * duration;\n    setTotalPrice(Math.round(calculatedPrice * 100) / 100); // Round to 2 decimal places\n  }, [adContent, duration, basePrice]);\n  const loadRazorpay = () => {\n    return new Promise(resolve => {\n      const script = document.createElement(\"script\");\n      script.src = \"https://checkout.razorpay.com/v1/checkout.js\";\n      script.onload = () => resolve(window.Razorpay);\n      document.body.appendChild(script);\n    });\n  };\n  const handlePayment = async () => {\n    if (!adTitle || !adContent) {\n      alert(\"Please fill all fields\");\n      return;\n    }\n    setLoading(true);\n    try {\n      // 1. Load Razorpay script\n      const Razorpay = await loadRazorpay();\n\n      // 2. Create payment options\n      const options = {\n        key: process.env.REACT_APP_RAZORPAY_KEY_ID,\n        amount: totalPrice * 100,\n        // Razorpay uses paise\n        currency: \"INR\",\n        name: \"The Virtual Times\",\n        description: `Ad Booking: ${adTitle.substring(0, 30)}...`,\n        handler: async response => {\n          await verifyAndCompleteBooking(response);\n        },\n        prefill: {\n          name: (user === null || user === void 0 ? void 0 : user.name) || \"\",\n          email: (user === null || user === void 0 ? void 0 : user.email) || \"\",\n          contact: (user === null || user === void 0 ? void 0 : user.phone) || \"9999999999\"\n        },\n        theme: {\n          color: \"#3399cc\"\n        }\n      };\n\n      // 3. Open payment modal\n      const rzp = new Razorpay(options);\n      rzp.open();\n    } catch (error) {\n      console.error(\"Payment error:\", error);\n      alert(\"Payment initialization failed\");\n    } finally {\n      setLoading(false);\n    }\n  };\n  const verifyAndCompleteBooking = async paymentResponse => {\n    try {\n      const bookingData = {\n        razorpay_payment_id: paymentResponse.razorpay_payment_id,\n        razorpay_order_id: paymentResponse.razorpay_order_id,\n        razorpay_signature: paymentResponse.razorpay_signature,\n        userId: user.id,\n        newspaperId,\n        spaceId,\n        title: adTitle,\n        content: adContent,\n        category,\n        duration,\n        price: totalPrice,\n        newspaperName,\n        email: user.email\n      };\n      const response = await fetch(\"http://localhost:5000/api/ad-booking/verify-and-book\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n          Authorization: `Bearer ${user.token}`\n        },\n        body: JSON.stringify(bookingData)\n      });\n      const result = await response.json();\n      if (result.success) {\n        alert(\"ðŸŽ‰ Ad booked successfully!\");\n        navigate(\"/my-ads\");\n      } else {\n        alert(`Booking failed: ${result.message || \"Please try again\"}`);\n      }\n    } catch (error) {\n      console.error(\"Booking error:\", error);\n      alert(\"Booking verification failed. Contact support.\");\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"deccan-booking\",\n    children: /*#__PURE__*/_jsxDEV(\"button\", {\n      onClick: handlePayment,\n      disabled: loading || !user,\n      className: \"book-ad-button\",\n      children: loading ? \"Processing...\" : `Pay â‚¹${totalPrice}`\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 123,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 121,\n    columnNumber: 5\n  }, this);\n};\n_s(DeccanChroniclesBooking, \"BMSIafU7kzMItpF2vMEEOACRJfQ=\", false, function () {\n  return [useLocation, useNavigate];\n});\n_c = DeccanChroniclesBooking;\nexport default DeccanChroniclesBooking;\nvar _c;\n$RefreshReg$(_c, \"DeccanChroniclesBooking\");","map":{"version":3,"names":["React","useState","useEffect","useContext","useLocation","useNavigate","AuthContext","jsxDEV","_jsxDEV","DeccanChroniclesBooking","_s","user","location","navigate","price","basePrice","newspaperId","spaceId","newspaperName","state","adTitle","setAdTitle","adContent","setAdContent","category","setCategory","duration","setDuration","totalPrice","setTotalPrice","loading","setLoading","calculatedPrice","length","Math","round","loadRazorpay","Promise","resolve","script","document","createElement","src","onload","window","Razorpay","body","appendChild","handlePayment","alert","options","key","process","env","REACT_APP_RAZORPAY_KEY_ID","amount","currency","name","description","substring","handler","response","verifyAndCompleteBooking","prefill","email","contact","phone","theme","color","rzp","open","error","console","paymentResponse","bookingData","razorpay_payment_id","razorpay_order_id","razorpay_signature","userId","id","title","content","fetch","method","headers","Authorization","token","JSON","stringify","result","json","success","message","className","children","onClick","disabled","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["D:/gopika/backup_08_02_2025/online-newspaper-ad-booking/frontend/src/pages/layouts/DeccanChroniclesBooking.js"],"sourcesContent":["import React, { useState, useEffect, useContext } from \"react\";\r\nimport { useLocation, useNavigate } from \"react-router-dom\";\r\nimport { AuthContext } from \"../../context/AuthContext\";\r\nimport \"../../styles/DeccanChroniclesBooking.css\";\r\n\r\nconst DeccanChroniclesBooking = () => {\r\n  const { user } = useContext(AuthContext);\r\n  const location = useLocation();\r\n  const navigate = useNavigate();\r\n  const { price: basePrice, newspaperId = 1, spaceId, newspaperName } = location.state || {};\r\n\r\n  // Form states\r\n  const [adTitle, setAdTitle] = useState(\"\");\r\n  const [adContent, setAdContent] = useState(\"\");\r\n  const [category, setCategory] = useState(\"Jobs\");\r\n  const [duration, setDuration] = useState(1);\r\n  const [totalPrice, setTotalPrice] = useState(basePrice || 0);\r\n  const [loading, setLoading] = useState(false);\r\n\r\n  // Calculate price dynamically\r\n  useEffect(() => {\r\n    const calculatedPrice = (basePrice + (adContent.length * 0.5)) * duration;\r\n    setTotalPrice(Math.round(calculatedPrice * 100) / 100); // Round to 2 decimal places\r\n  }, [adContent, duration, basePrice]);\r\n\r\n  const loadRazorpay = () => {\r\n    return new Promise((resolve) => {\r\n      const script = document.createElement(\"script\");\r\n      script.src = \"https://checkout.razorpay.com/v1/checkout.js\";\r\n      script.onload = () => resolve(window.Razorpay);\r\n      document.body.appendChild(script);\r\n    });\r\n  };\r\n\r\n  const handlePayment = async () => {\r\n    if (!adTitle || !adContent) {\r\n      alert(\"Please fill all fields\");\r\n      return;\r\n    }\r\n\r\n    setLoading(true);\r\n    \r\n    try {\r\n      // 1. Load Razorpay script\r\n      const Razorpay = await loadRazorpay();\r\n\r\n      // 2. Create payment options\r\n      const options = {\r\n        key: process.env.REACT_APP_RAZORPAY_KEY_ID,\r\n        amount: totalPrice * 100, // Razorpay uses paise\r\n        currency: \"INR\",\r\n        name: \"The Virtual Times\",\r\n        description: `Ad Booking: ${adTitle.substring(0, 30)}...`,\r\n        handler: async (response) => {\r\n          await verifyAndCompleteBooking(response);\r\n        },\r\n        prefill: {\r\n          name: user?.name || \"\",\r\n          email: user?.email || \"\",\r\n          contact: user?.phone || \"9999999999\"\r\n        },\r\n        theme: {\r\n          color: \"#3399cc\"\r\n        }\r\n      };\r\n\r\n      // 3. Open payment modal\r\n      const rzp = new Razorpay(options);\r\n      rzp.open();\r\n\r\n    } catch (error) {\r\n      console.error(\"Payment error:\", error);\r\n      alert(\"Payment initialization failed\");\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const verifyAndCompleteBooking = async (paymentResponse) => {\r\n    try {\r\n      const bookingData = {\r\n        razorpay_payment_id: paymentResponse.razorpay_payment_id,\r\n        razorpay_order_id: paymentResponse.razorpay_order_id,\r\n        razorpay_signature: paymentResponse.razorpay_signature,\r\n        userId: user.id,\r\n        newspaperId,\r\n        spaceId,\r\n        title: adTitle,\r\n        content: adContent,\r\n        category,\r\n        duration,\r\n        price: totalPrice,\r\n        newspaperName,\r\n        email: user.email\r\n      };\r\n\r\n      const response = await fetch(\"http://localhost:5000/api/ad-booking/verify-and-book\", {\r\n        method: \"POST\",\r\n        headers: { \r\n          \"Content-Type\": \"application/json\",\r\n          Authorization: `Bearer ${user.token}`\r\n        },\r\n        body: JSON.stringify(bookingData)\r\n      });\r\n\r\n      const result = await response.json();\r\n\r\n      if (result.success) {\r\n        alert(\"ðŸŽ‰ Ad booked successfully!\");\r\n        navigate(\"/my-ads\");\r\n      } else {\r\n        alert(`Booking failed: ${result.message || \"Please try again\"}`);\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Booking error:\", error);\r\n      alert(\"Booking verification failed. Contact support.\");\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"deccan-booking\">\r\n      {/* Your existing form JSX */}\r\n      <button \r\n        onClick={handlePayment} \r\n        disabled={loading || !user}\r\n        className=\"book-ad-button\"\r\n      >\r\n        {loading ? \"Processing...\" : `Pay â‚¹${totalPrice}`}\r\n      </button>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default DeccanChroniclesBooking;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}